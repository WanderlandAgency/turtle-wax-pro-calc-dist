"use strict";(()=>{var E=(e,t=!0)=>e.cloneNode(t);function C(e,t){if(!t)return T(e.chemicals);let r=e.chemicals.filter(o=>o.washtype===t);return T(r)}function w(e,t,r){return T(e.chemicals.filter(o=>o.washtype===t&&r.includes(o.name)))}function T(e){return e.reduce((t,r)=>t+r.price,0)}function L(e,t){let r=t/100;return e/(1-r)}function m(e){return Math.round(e*100)/100}var g=["Self-Serve","In-Bay Automatic","Tunnel"];function A(e){return g.includes(e)}function S(e){e.innerHTML=""}function y(e,...t){t.forEach(r=>e.append(r))}function b(e,t){let r=document.createElement("option");return r.innerText=e,r.setAttribute("value",t),r}function W(e,t){var i;let o=Array.from(e.querySelectorAll(`input[type='radio'][data-name='${t}']`)).find(n=>n.checked);return(i=o==null?void 0:o.value)!=null?i:null}function p(e,t,r){Array.from(e.querySelectorAll(`input[type='hidden'][name='${t}']`)).forEach(n=>n.remove());let i=document.createElement("input");i.type="hidden",i.name=t,i.value=r,e.appendChild(i)}function H(){return Array.from(document.querySelectorAll("[data-twp-provider-name]")).map(r=>{var n;let o={name:(n=r.dataset.twpProviderName)!=null?n:"",chemicals:[]};return Array.from(r.querySelectorAll("[data-twp-chemical-name]")).forEach(l=>{var u;let a=l.dataset.twpChemicalWashtype;if(!g.includes(a!=null?a:""))throw new Error("invalid washtype "+a);o.chemicals.push({name:(u=l.dataset.twpChemicalName)!=null?u:"",price:Number(l.dataset.twpChemicalPrice)||0,washtype:a})}),o})}function M(e){if(e.length===0)throw new Error("Provider list cannot be empty");let t=[],r=e[0].chemicals;for(let o of r){let i=0,n=0;for(let l of e){let a=l.chemicals.find(u=>u.name===o.name&&u.washtype===o.washtype);a&&(i+=a.price,n++)}n>0&&t.push({...o,price:i/n})}return{name:"Other",chemicals:t}}function v(e){let t=W(e,"Wash Type");if(!A(t))throw new Error("invalid washtype");return t}function N(e){return Array.from(e.querySelectorAll("input[type='checkbox']")).filter(i=>i.checked).map(i=>{var n;return(n=i.getAttribute("data-name"))!=null?n:""}).filter(i=>i)}function q(e,t){let r=t.value;if(!r)throw new Error("no selected provider value");return e.find(o=>o.name===r)}function k(e){let t=e.querySelector("input[data-name='Cost-per-car']")||null;if(!t)throw new Error("no input element");return Number(t.value)||0}function I(e){let t=e.querySelector("input[data-name='Discount Percentage']")||null;if(!t)throw new Error("no input element");return Number(t.value)||0}var D="twp-calc",c=e=>`[${D}='${e}']`,s=document.querySelector(c("form")),B=s.parentElement,x=s.querySelector(c("chemical-checkbox-list")),R=x.querySelector(c("chemical-checkbox-item")),F=s.querySelector(c("select-provider")),d=B.querySelector(c("success-higher")),f=B.querySelector(c("success-lower")),V=s.querySelector("[if-element='button-next']"),O=s.querySelector(c("button-next-chemical-selection")),G=s.querySelector(c("button-next-discount"));d.style.display="none";f.style.display="none";var h=H(),P=h.find(e=>e.name==="Turtle Wax Pro");if(!P)throw new Error("Could not find Turtle Wax Pro");var $=M(h.filter(e=>e.name!=="Turtle Wax Pro"));h.push($);var j=[F];j.forEach(e=>{S(e);let t=h.filter(r=>r.name!=="Turtle Wax Pro").map(r=>b(r.name,r.name));y(e,b("Select your provider...","")),y(e,...t)});V.addEventListener("click",()=>{S(x);let e=v(s),r=P.chemicals.filter(o=>o.washtype===e).map(o=>{let i=E(R),n=i.querySelector("input[type='checkbox']"),l=i.querySelector(c("chemical-checkbox-label"));return n==null||n.setAttribute("value",o.name),n==null||n.setAttribute("data-name",o.name),n==null||n.setAttribute("id",o.name),l.textContent=o.name,i});y(x,...r)});V.addEventListener("click",()=>{window.InputflowApi.beforeSubmit.push({f:()=>K(s),stopSubmission:!1})});O.addEventListener("click",()=>{let e=N(x),t=v(s),r=q(h,F),o=w(P,t,e),i=w(r,t,e),n=i-o;window.InputflowApi.setVariable("savedAmount",n),p(s,"Result - Turtle Wax Pro price",String(m(o))),p(s,"Result - Competitor price",String(m(i))),p(s,"Result - Turtle Wax Pro saves",String(m(n))),n>0?(d.style.display="none",f.style.display="flex",window.InputflowApi.goToStep("Good news",!1)):(d.style.display="flex",f.style.display="none",window.InputflowApi.goToStep("Bonus",!1))});G.addEventListener("click",()=>{let e=v(s),t=k(s),r=I(s),o=L(t,r),i=C(P,e),n=o-i;window.InputflowApi.setVariable("savedAmount",n),p(s,"Result - Turtle Wax Pro price",String(m(i))),p(s,"Result - Competitor price",String(m(o))),p(s,"Result - Turtle Wax Pro saves",String(m(n))),n>0?(d.style.display="none",f.style.display="flex",window.InputflowApi.goToStep("Good news",!1)):(d.style.display="flex",f.style.display="none",window.InputflowApi.goToStep("Bonus",!1))});function K(e){Array.from(e.querySelectorAll(c("remove-if-empty"))).forEach(r=>{r.value||r.remove()})}})();
